{% extends 'KRSolutionsKRCMSBundle::layout.html.twig' %}

{% block title %}{% if action == 'new' %}{{ 'page.add_page'|trans({}, 'KRSolutionsKRCMSBundle') }}{% else %}{{ 'page.edit_page'|trans({}, 'KRSolutionsKRCMSBundle') }}{% endif %} - Content Management Systeem{% endblock %}

{% block header %}
	<div class="col-lg-8">
		<h1 class="page-header">
			{% if action == 'new' %}
				{{ 'page.add_page'|trans({}, 'KRSolutionsKRCMSBundle') }}
			{% else %}
				{{ 'page.edit_page'|trans({}, 'KRSolutionsKRCMSBundle') }}
			{% endif %}
			{% if page.title %}
				<small>{{ page.title }}</small>
			{% endif %}
		</h1>
	</div>
	<div class="col-lg-4">
		<div class="page-header pull-right">
			<div class="btn-group">
				<a id="save_page" class="btn btn-primary" href="javascript:void(0)"><i class="fa fa-floppy-o"></i> {{ 'layout.save'|trans({}, 'KRSolutionsKRCMSBundle') }}</a>
				{% if page.parent is not null %}
					{% set parentPageId = page.parent.id %}
				{% else %}
					{% set parentPageId = null %}
				{% endif %}
				<a class="btn btn-default" href="{{ path('kr_solutions_krcms_pages_index', { 'siteId': site.id, 'parentPageId': parentPageId }) }}" title="{{ 'page.back_to_page_overview'|trans({}, 'KRSolutionsKRCMSBundle') }}"><i class="fa fa-stop"></i> {{ 'layout.cancel'|trans({}, 'KRSolutionsKRCMSBundle') }}</a>
			</div>
		</div>
	</div>
{% endblock %}

{% block content %}
	<div class="col-md-9">
		<div class="well">
			<form id="pageForm" action="{% if action == 'new' %}{{ path('kr_solutions_krcms_pages_add', { 'siteId': site.id, 'pageTypeId': page.pageType.id }) }}{% else %}{{ path('kr_solutions_krcms_pages_edit', { 'pageId': page.id }) }}{% endif %}" method="post" {{ form_enctype(pageForm) }} novalidate="novalidate">
				<fieldset>
					{% if form_errors(pageForm) %}
						<div class="alert alert-danger">
							<button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">{{ 'layout.close'|trans({}, 'KRSolutionsKRCMSBundle') }}</span></button>
							<h4>{{ 'layout.form_error_alert_heading'|trans({}, 'KRSolutionsKRCMSBundle') }}</h4>
							{{ form_errors(pageForm) }}
						</div>
					{% endif %}

					<div class="form-group{% if pageForm.title.vars.errors|length %} has-error{% endif %}">
						{{ form_label(pageForm.title) }}
						{{ form_widget(pageForm.title, { 'attr': {'class': 'form-control'} }) }}
					</div>

					<div class="form-group{% if pageForm.truePermalink.vars.errors|length %} has-error{% endif %}">
						{{ form_label(pageForm.truePermalink) }}
						{{ form_widget(pageForm.truePermalink, { 'attr': {'class': 'form-control'} }) }}
					</div>

					{% if pageForm.menu is defined %}
						<div class="form-group{% if pageForm.menu.vars.errors|length %} has-error{% endif %}">
							{{ form_label(pageForm.menu) }}
							{{ form_widget(pageForm.menu, { 'attr': {'class': 'form-control'} }) }}
						</div>

						<div class="form-group{% if pageForm.menuTitle.vars.errors|length %} has-error{% endif %}">
							{{ form_label(pageForm.menuTitle) }}
							{{ form_widget(pageForm.menuTitle, { 'attr': {'class': 'form-control'} }) }}
						</div>
					{% endif %}

					{% if pageForm['parent'] is defined %}
						<div class="form-group{% if pageForm.parent.vars.errors|length %} has-error{% endif %}">
							{{ form_label(pageForm.parent) }}
							{{ form_widget(pageForm.parent, { 'attr': {'class': 'form-control'} }) }}
						</div>
					{% endif %}

					{% if pageForm.content is defined %}
						<div class="form-group{% if form_errors(pageForm.content) %} error{% endif %}">
							{{ form_label(pageForm.content) }}
							{{ form_widget(pageForm.content, { 'attr': {'class': 'form-control'} }) }}
						</div>
					{% endif %}

					<div class="form-group{% if form_errors(pageForm.metaDescription) %} error{% endif %}">
						{{ form_label(pageForm.metaDescription) }}
						{{ form_widget(pageForm.metaDescription, { 'attr': {'class': 'form-control'} }) }}
					</div>

					{{ form_rest(pageForm) }}
				</fieldset>
				<button class="btn btn-primary" type="submit"><i class="fa fa-floppy-o"></i> {{ 'layout.save'|trans({}, 'KRSolutionsKRCMSBundle') }}</button>
			</form>
		</div>
	</div>
	<div class="col-md-3">
		<div class="well">
			<ul class="list-unstyled">
				<li><h3>{{ 'page.details'|trans({}, 'KRSolutionsKRCMSBundle') }}</h3></li>
						{% if page.createdBy is not null %}
					<li style="margin-bottom: 10px;"><span class="clearfix">{{ 'layout.created_by'|trans({}, 'KRSolutionsKRCMSBundle') }}:</span> <strong>{% if page.createdBy.KRCMSUsername is defined %}{{ page.createdBy.KRCMSUsername }}{% else %}{{ page.createdBy.username }}{% endif %}</strong></li>
					{% endif %}
					{% if page.createdAt is not null %}
					<li style="margin-bottom: 10px;"><span class="clearfix">{{ 'layout.created_at'|trans({}, 'KRSolutionsKRCMSBundle') }}:</span> <strong>{{ page.createdAt|localizeddate('medium', 'medium') }}</strong></li>
					{% endif %}
					{% if page.updatedBy is not null %}
					<li style="margin-bottom: 10px;"><span class="clearfix">{{ 'layout.updated_by'|trans({}, 'KRSolutionsKRCMSBundle') }}:</span> <strong>{% if page.createdBy.KRCMSUsername is defined %}{{ page.updatedBy.KRCMSUsername }}{% else %}{{ page.createdBy.username }}{% endif %}</strong></li>
					{% endif %}
					{% if page.updatedAt is not null and page.updatedAt != page.createdAt %}
					<li style="margin-bottom: 10px;"><span class="clearfix">{{ 'layout.updated_at'|trans({}, 'KRSolutionsKRCMSBundle') }}:</span> <strong>{{ page.updatedAt|localizeddate('medium', 'medium') }}</strong></li>
					{% endif %}
			</ul>
		</div>
	</div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}

	<script type="text/javascript">
		$(document).ready(function () {
			$('#page_title').change(function () {
				$.ajax({
					type: 'POST',
					url: '{{ path('kr_solutions_krcms_pages_generate_permalink') }}',
					dataType: 'text',
					data: {
						text: $('#page_title').val(){% if page.id is not null %},
						page_id: {{ page.id }}{% endif %}
					}
				}).done(function(data) {
					$('#page_truePermalink').val(data);
				});
			});

			$('#save_page').on('click', function () {
				$('#pageForm').submit();
			});
		});

		{% if pageForm.content is defined %}
			/* <![CDATA[ */
			// This is a check for the CKEditor class. If not defined, the paths must be checked.
			if (typeof CKEDITOR === 'undefined') {
				document.write(
						'<strong><span style="color: #ff0000">Error</span>: CKEditor not found</strong>.' +
						'This sample assumes that CKEditor (not included with CKFinder) is installed in' +
						'the "/ckeditor/" path. If you have it installed in a different place, just edit' +
						'this file, changing the wrong paths in the &lt;head&gt; (line 5) and the "BasePath"' +
						'value (line 32).');
			} else {
				var editor = CKEDITOR.replace('page_content',
						{
							filebrowserBrowseUrl: '/bundles/krsolutionskrcms/kcfinder/browse.php?type:files',
							filebrowserImageBrowseUrl: '/bundles/krsolutionskrcms/kcfinder/browse.php?type:images',
							filebrowserFlashBrowseUrl: '/bundles/krsolutionskrcms/kcfinder/browse.php?type:flash',
							filebrowserUploadUrl: '/bundles/krsolutionskrcms/kcfinder/upload.php?type:files',
							filebrowserImageUploadUrl: '/bundles/krsolutionskrcms/kcfinder/upload.php?type:images',
							filebrowserFlashUploadUrl: '/bundles/krsolutionskrcms/kcfinder/upload.php?type:flash'
						});
			}
			/* ]]> */
		{% endif %}
	</script>
{% endblock %}